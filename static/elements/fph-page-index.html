<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/core-item/core-item.html">
<link rel="import" href="/bower_components/paper-button/paper-button.html">
<link rel="import" href="/bower_components/paper-input/paper-input.html">
<link rel="import" href="/bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="/elements/fph-my-tags-service.html">
<link rel="import" href="/elements/fph-show-tag-service.html">
<link rel="import" href="/elements/fph-tag-products-service.html">
<link rel="import" href="/elements/fph-create-tag-service.html">

<polymer-element name="fph-page-index">
  <template>
    <fph-my-tags-service
      id="myTags"
      tags="{{tags}}"></fph-my-tags-service>
    <fph-show-tag-service
      id="showTag"
      tagId="{{tagId}}"
      tag="{{tag}}"></fph-show-tag-service>
    <fph-tag-products-service
      id="tagProducts"
      tagId="{{tagId}}"
      products="{{products}}"></fph-tag-products-service>
    <fph-create-tag-service
      id="createTag"
      name="{{newTagName}}"
      public="{{newTagPublic}}"
      on-tag-created="{{onTagCreated}}"></fph-create-tag-service>

    <core-scaffold>
      <core-header-panel navigation flex>
        <core-menu on-core-select="{{tagSelected}}">
          <template repeat="{{tag in tags}}">
            <core-item label="{{tag.Name}}" id="{{tag.Id}}"></core-item>
          </template>
          <core-item label="New Tag" id="newTag"></core-item>
        </core-menu>
      </core-header-panel>

      <span tool>{{tag.Name}}</span>

      <div class="content">
        <template if="{{tag.Id}}">
          <template if="{{products.length == 0}}">
            <p>No products</p>
          </template>
          <template if="{{products.length != 0}}">
            <template repeat="{{product in products}}">
              <p>
                {{product.tag_votes}}:
                <a target="_blank" href="{{product.discussion_url}}">{{product.name}}</a>
                {{product.created_at}}
              </p>
            </template>
          </template>
        </template>
        <template if="{{!tag.Id}}">
          <template if="{{newTagForm}}">
            <paper-input label="Name" value="{{newTagName}}"></paper-input>
            <paper-toggle-button checked="{{newTagPublic}}"></paper-toggle-button>
            <paper-button label="Create Tag" on-tap="{{newTagTapped}}"></paper-button>
          </template>
          <template if="{{!newTagForm}}">
            <p>Select a tag!</p>
          </template>
        </template>
      </div>
    </core-scaffold>
  </template>
  <script>
  Polymer({
    newTagName: "",
    newTagPublic: true,
    tagSelected: function(e, detail) {
      console.log(e);
      console.log(detail);
      if (detail.isSelected) {
        console.log(detail.item.id);
        if (detail.item.id == "newTag") {
          this.newTagForm = true;
          this.tagId = null;
          this.tag = {};
        } else {
          this.newTagForm = false;
          this.tagId = detail.item.id;
        }
      }
    },
    newTagTapped: function() {
      console.log("create tag");
      this.$.createTag.load();
    },
    onTagCreated: function(e, detail) {
      console.log(e);
      console.log(detail);
      this.$.myTags.load();
    }
  });
  </script>
</polymer-element>
